{"json":[{"block":{"Id":"1b19ba06-3ca0-81dd-b559-c1290e74e6c8","Type":"paragraph","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Paragraph":{"RichTexts":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"Lorem ipsum content with an image and a random file below","Href":null,"Text":{"Content":"Lorem ipsum content with an image and a random file below"}}],"Color":"default"}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8137-bb2a-d27d8a3f4a42","Type":"code","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Code":{"Caption":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)","Href":null,"Text":{"Content":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)"}}],"RichTexts":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}","Href":null,"Text":{"Content":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}"}}],"Language":"javascript"}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8134-8fa7-e3ca9e9197aa","Type":"toggle","HasChildren":true,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Toggle":{"RichTexts":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"Code in case you want to host somewhere else","Href":null,"Text":{"Content":"Code in case you want to host somewhere else"}}],"Color":"default","Children":[{"Id":"1b19ba06-3ca0-8115-8c25-e4c5ee608679","Type":"code","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Code":{"Caption":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)","Href":null,"Text":{"Content":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)"}}],"RichTexts":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}","Href":null,"Text":{"Content":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}"}}],"Language":"javascript"}},{"Id":"1b19ba06-3ca0-8199-b539-cab72d27459a","Type":"paragraph","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Paragraph":{"RichTexts":[],"Color":"default"}}]}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8115-8c25-e4c5ee608679","Type":"code","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Code":{"Caption":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)","Href":null,"Text":{"Content":"Remember this code is in format of val town and hence the weird imports. You would need to switch that to require probably (I ain’t good at JS)"}}],"RichTexts":[{"Annotation":{"Bold":false,"Italic":false,"Strikethrough":false,"Underline":false,"Code":false,"Color":"default"},"PlainText":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}","Href":null,"Text":{"Content":"import process from \"node:process\";\nimport { TodoistApi } from \"npm:@doist/todoist-api-typescript\";\nimport { Client } from \"npm:@notionhq/client\";\n\nconst TODOIST_API_KEY = process.env.TODOIST_API_KEY;\nconst todoistapi = new TodoistApi(TODOIST_API_KEY);\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\nconst notion = new Client({\n  auth: NOTION_API_KEY,\n});\n\nvar add_to_notion_todoist_project_id = \"PROJECT_ID_HERE\";\n\nvar todoist_dict_mapping = {\n  \"habit\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"page\",\n    \"notion-id\": \"PAGE_ID_HERE\",\n  },\n  \"papers\": {\n    \"todoist-section-id\": \"SECTION_ID_HERE\",\n    \"notion-map-type\": \"database\",\n    \"notion-id\": \"DB_ID_HERE\",\n  },\n};\n\nfunction getNotionId(section_id) {\n  if (!section_id) {\n    return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n  }\n\n  for (var key in todoist_dict_mapping) {\n    if (todoist_dict_mapping[key][\"todoist-section-id\"] === section_id) {\n      return [\n        todoist_dict_mapping[key][\"notion-map-type\"] || todoist_dict_mapping[\"dump\"][\"notion-map-type\"],\n        todoist_dict_mapping[key][\"notion-id\"] || todoist_dict_mapping[\"dump\"][\"notion-id\"],\n      ];\n    }\n  }\n\n  return [todoist_dict_mapping[\"dump\"][\"notion-map-type\"], todoist_dict_mapping[\"dump\"][\"notion-id\"]];\n}\n\nfunction convertDateObject(due) {\n  function convertToISOWithOffset(datetimeStr, timezoneStr) {\n    const date = new Date(datetimeStr);\n    const [, sign, hours, minutes] = timezoneStr.match(/GMT ([+-])(\\d{1,2}):(\\d{2})/);\n    date.setUTCMinutes(date.getUTCMinutes() + (parseInt(hours) * 60 + parseInt(minutes)) * (sign === \"+\" ? 1 : -1));\n    return date.toISOString().split(\".\")[0]\n      + `${sign}${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\n  }\n  const formatDate = (date, datetime, timezone) => {\n    let isoString = datetime ? datetime : date;\n    if (timezone && timezone.startsWith(\"GMT\") && timezone.length > 3) {\n      return convertToISOWithOffset(datetime, timezone);\n    } else {\n      return isoString;\n    }\n  };\n\n  return {\n    start: due ? formatDate(due.date, due.datetime, due.timezone) : new Date().toISOString(),\n    end: null,\n    time_zone: due && due.datetime && due.timezone && due.timezone.startsWith(\"GMT\") && due.timezone.length > 3\n      ? null\n      : (due && due.datetime && due.timezone ? due.timezone : \"America/Los_Angeles\"),\n  };\n}\n\nasync function addCalloutToNotionPage(page_id, content, date) {\n  console.log(JSON.stringify(date));\n  const response = await notion.blocks.children.append({\n    block_id: page_id,\n    children: [{\n      \"callout\": {\n        \"rich_text\": [{\n          \"type\": \"mention\",\n          \"mention\": {\n            \"type\": \"date\",\n            \"date\": date,\n          },\n        }],\n        \"icon\": {\n          \"type\": \"external\",\n          \"external\": {\n            \"url\": \"https://www.notion.so/icons/circle-dot_lightgray.svg\",\n          },\n        },\n        \"children\": [{\n          \"paragraph\": {\n            \"rich_text\": [{\n              \"text\": {\n                \"content\": content,\n              },\n            }],\n          },\n        }],\n      },\n    }],\n  });\n  console.log(JSON.stringify(response));\n}\n\nasync function addPageToNotionDatabse(database_id, content) {\n  const response = await notion.pages.create({\n    \"parent\": {\n      \"type\": \"database_id\",\n      \"database_id\": database_id,\n    },\n    \"properties\": {\n      \"Name\": {\n        \"title\": [{\n          \"text\": {\n            \"content\": content,\n          },\n        }],\n      },\n    },\n  });\n}\n\nexport default async function(interval: Interval) {\n  var tasks = await todoistapi.getTasks({\n    projectId: add_to_notion_todoist_project_id,\n  });\n\n  for (const task of tasks) {\n    console.log(task);\n    const [mappedNotionType, mappedNotionId] = getNotionId(task.sectionId);\n    if (mappedNotionId)\n    {\n      if (mappedNotionType == \"page\" && mappedNotionId) {\n        addCalloutToNotionPage(mappedNotionId, task.content, convertDateObject(task.due));\n      }\n      else if (mappedNotionType == \"database\" && mappedNotionId) {\n        addPageToNotionDatabse(mappedNotionId, task.content);\n      }\n      todoistapi.deleteTask(task.id);\n    }\n  }\n}"}}],"Language":"javascript"}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8199-b539-cab72d27459a","Type":"paragraph","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Paragraph":{"RichTexts":[],"Color":"default"}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8112-8462-c2d93adf6e6a","Type":"paragraph","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","Paragraph":{"RichTexts":[],"Color":"default"}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":null,"link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8198-ac68-eca4e3fd0d2d","Type":"image","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","NImage":{"Caption":[],"Type":"file","File":{"Type":"file","Url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/c9edc8f4-4651-4576-9770-ad34ac5f8e1c/2f3a4c50-2627-4977-8dfa-38230546f428/pcat.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667QTDBKVM%2F20250309%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250309T192837Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDIaCXVzLXdlc3QtMiJGMEQCIDSZoetpRASsFXeTHLiMftG9Z9Aoao8oP33GrKb1DTpfAiApg3nc92BEnwiymFEZPNSRzDaO2l3wl%2BhPAsQCUlio2yr%2FAwh7EAAaDDYzNzQyMzE4MzgwNSIMXXem8iO6GlnLG8BzKtwDTyjjMu2ihRoGNpBgYLa0pNZby6CvEvnfDQf2hG5gJhO7WO0s7XgDh0dyn2yHPEP3kxqx1hMAYggsQlMs3e2ofDrnOQtCRCHUj3XjZqjzmYpUFSaZK%2BhNUeR5OVvgP%2FpIgn9PcTc2pbbIm7Wc9ZsMHaHhBCh1ZPhlZfbYg9G7btthJLPmmIWdDQrcVjUwkSUhtyK8mV5vzIKfO0bX%2BWvEGmVMQx%2F5kjecTdHxIZkl0lbEvZrxouybWPKLjGZVgzKj1EqPyzM7s0hoBRTRnwiEwXFrNwnHSC2kzscN6jnV45xDR1UKIXocaAt0bilEB5dQ7efbcOM5XHpsnlQ%2BxCOAqsOMYPQCX1dYQc20pXE7Kw4fCHwoEJVqDugojCsHxqwaanA7QtU3GHJlPk%2FlRXxcoNr1JJ7u9wysbE56vswl5Uw%2FgIdVJeEI%2FM1oClytmBK1CpQct%2BBLyxGrfbayKglPDok%2FBZY5Tn%2FSnok6vq4%2BQLMF0v7wCIEmRGgLVsqAtzwcFh%2BrZqOg9CAB6nh7RSThlqIjp252mjRv10jIeoLyZbTAaT%2Feg7gH68sUzPk%2BqgvWm3OAD5WuAMzY7wyK1tpDeES8xdwn355FlwgoPjnipB98wjDwMTpyKe6CcI8wzrS3vgY6pgGmXwC4W5O95OugZ3PzZd%2FDtrjiczyp%2BkFTfnjMksuGwrATR85BvArWVdwHPiHvbzw3O4PWeh7sZe37Bovegdkdobdkmz5lzq7TB2KN%2BcxIfACLspu8GDphKnrF8agNEaoqS3EF%2F6YNhiAhjNifIHLT8G5hikCgpMy%2FHJjuSJOckV9HoT1ktGWQ611GrXOlBhHsvLnB6Di5JFpnemEqgfsmkhUSzh2X&X-Amz-Signature=b178256b3cd5376a3477a56e93cd285d7a1bc59a2b16fa0c6fbee9335a89635b&X-Amz-SignedHeaders=host&x-id=GetObject","OptimizedUrl":"https://prod-files-secure.s3.us-west-2.amazonaws.com/c9edc8f4-4651-4576-9770-ad34ac5f8e1c/2f3a4c50-2627-4977-8dfa-38230546f428/pcat.webp","ExpiryTime":"2025-03-09T20:28:37.782Z"}}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":"https://prod-files-secure.s3.us-west-2.amazonaws.com/c9edc8f4-4651-4576-9770-ad34ac5f8e1c/2f3a4c50-2627-4977-8dfa-38230546f428/pcat.webp","link_to_pageid":null,"direct_nonmedia_link":null},{"block":{"Id":"1b19ba06-3ca0-8129-817e-f16214e47f4e","Type":"file","HasChildren":false,"LastUpdatedTimeStamp":"2025-03-09T13:11:00.000Z","File":{"Caption":[],"Type":"file","File":{"Type":"file","Url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/c9edc8f4-4651-4576-9770-ad34ac5f8e1c/b6a3dd52-7c49-47fc-8574-d48acf693647/sample2.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667QTDBKVM%2F20250309%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250309T192837Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDIaCXVzLXdlc3QtMiJGMEQCIDSZoetpRASsFXeTHLiMftG9Z9Aoao8oP33GrKb1DTpfAiApg3nc92BEnwiymFEZPNSRzDaO2l3wl%2BhPAsQCUlio2yr%2FAwh7EAAaDDYzNzQyMzE4MzgwNSIMXXem8iO6GlnLG8BzKtwDTyjjMu2ihRoGNpBgYLa0pNZby6CvEvnfDQf2hG5gJhO7WO0s7XgDh0dyn2yHPEP3kxqx1hMAYggsQlMs3e2ofDrnOQtCRCHUj3XjZqjzmYpUFSaZK%2BhNUeR5OVvgP%2FpIgn9PcTc2pbbIm7Wc9ZsMHaHhBCh1ZPhlZfbYg9G7btthJLPmmIWdDQrcVjUwkSUhtyK8mV5vzIKfO0bX%2BWvEGmVMQx%2F5kjecTdHxIZkl0lbEvZrxouybWPKLjGZVgzKj1EqPyzM7s0hoBRTRnwiEwXFrNwnHSC2kzscN6jnV45xDR1UKIXocaAt0bilEB5dQ7efbcOM5XHpsnlQ%2BxCOAqsOMYPQCX1dYQc20pXE7Kw4fCHwoEJVqDugojCsHxqwaanA7QtU3GHJlPk%2FlRXxcoNr1JJ7u9wysbE56vswl5Uw%2FgIdVJeEI%2FM1oClytmBK1CpQct%2BBLyxGrfbayKglPDok%2FBZY5Tn%2FSnok6vq4%2BQLMF0v7wCIEmRGgLVsqAtzwcFh%2BrZqOg9CAB6nh7RSThlqIjp252mjRv10jIeoLyZbTAaT%2Feg7gH68sUzPk%2BqgvWm3OAD5WuAMzY7wyK1tpDeES8xdwn355FlwgoPjnipB98wjDwMTpyKe6CcI8wzrS3vgY6pgGmXwC4W5O95OugZ3PzZd%2FDtrjiczyp%2BkFTfnjMksuGwrATR85BvArWVdwHPiHvbzw3O4PWeh7sZe37Bovegdkdobdkmz5lzq7TB2KN%2BcxIfACLspu8GDphKnrF8agNEaoqS3EF%2F6YNhiAhjNifIHLT8G5hikCgpMy%2FHJjuSJOckV9HoT1ktGWQ611GrXOlBhHsvLnB6Di5JFpnemEqgfsmkhUSzh2X&X-Amz-Signature=4cc20dfd530a400e6f3d1759a07aa04d0ffddbae3cfc5f54631b769f0c7150f3&X-Amz-SignedHeaders=host&x-id=GetObject","ExpiryTime":"2025-03-09T20:28:37.784Z"}}},"other_pages":[],"external_hrefs":[],"same_page":[],"direct_media_link":"https://prod-files-secure.s3.us-west-2.amazonaws.com/c9edc8f4-4651-4576-9770-ad34ac5f8e1c/b6a3dd52-7c49-47fc-8574-d48acf693647/sample2.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667QTDBKVM%2F20250309%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250309T192837Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDIaCXVzLXdlc3QtMiJGMEQCIDSZoetpRASsFXeTHLiMftG9Z9Aoao8oP33GrKb1DTpfAiApg3nc92BEnwiymFEZPNSRzDaO2l3wl%2BhPAsQCUlio2yr%2FAwh7EAAaDDYzNzQyMzE4MzgwNSIMXXem8iO6GlnLG8BzKtwDTyjjMu2ihRoGNpBgYLa0pNZby6CvEvnfDQf2hG5gJhO7WO0s7XgDh0dyn2yHPEP3kxqx1hMAYggsQlMs3e2ofDrnOQtCRCHUj3XjZqjzmYpUFSaZK%2BhNUeR5OVvgP%2FpIgn9PcTc2pbbIm7Wc9ZsMHaHhBCh1ZPhlZfbYg9G7btthJLPmmIWdDQrcVjUwkSUhtyK8mV5vzIKfO0bX%2BWvEGmVMQx%2F5kjecTdHxIZkl0lbEvZrxouybWPKLjGZVgzKj1EqPyzM7s0hoBRTRnwiEwXFrNwnHSC2kzscN6jnV45xDR1UKIXocaAt0bilEB5dQ7efbcOM5XHpsnlQ%2BxCOAqsOMYPQCX1dYQc20pXE7Kw4fCHwoEJVqDugojCsHxqwaanA7QtU3GHJlPk%2FlRXxcoNr1JJ7u9wysbE56vswl5Uw%2FgIdVJeEI%2FM1oClytmBK1CpQct%2BBLyxGrfbayKglPDok%2FBZY5Tn%2FSnok6vq4%2BQLMF0v7wCIEmRGgLVsqAtzwcFh%2BrZqOg9CAB6nh7RSThlqIjp252mjRv10jIeoLyZbTAaT%2Feg7gH68sUzPk%2BqgvWm3OAD5WuAMzY7wyK1tpDeES8xdwn355FlwgoPjnipB98wjDwMTpyKe6CcI8wzrS3vgY6pgGmXwC4W5O95OugZ3PzZd%2FDtrjiczyp%2BkFTfnjMksuGwrATR85BvArWVdwHPiHvbzw3O4PWeh7sZe37Bovegdkdobdkmz5lzq7TB2KN%2BcxIfACLspu8GDphKnrF8agNEaoqS3EF%2F6YNhiAhjNifIHLT8G5hikCgpMy%2FHJjuSJOckV9HoT1ktGWQ611GrXOlBhHsvLnB6Di5JFpnemEqgfsmkhUSzh2X&X-Amz-Signature=4cc20dfd530a400e6f3d1759a07aa04d0ffddbae3cfc5f54631b769f0c7150f3&X-Amz-SignedHeaders=host&x-id=GetObject","link_to_pageid":null,"direct_nonmedia_link":null}],"meta":{"values":{"0.block.LastUpdatedTimeStamp":["Date"],"1.block.LastUpdatedTimeStamp":["Date"],"2.block.LastUpdatedTimeStamp":["Date"],"2.block.Toggle.Children.0.LastUpdatedTimeStamp":["Date"],"2.block.Toggle.Children.1.LastUpdatedTimeStamp":["Date"],"3.block.LastUpdatedTimeStamp":["Date"],"4.block.LastUpdatedTimeStamp":["Date"],"5.block.LastUpdatedTimeStamp":["Date"],"6.block.LastUpdatedTimeStamp":["Date"],"7.block.LastUpdatedTimeStamp":["Date"]},"referentialEqualities":{"3.block":["2.block.Toggle.Children.0"],"4.block":["2.block.Toggle.Children.1"]}}}